{{#*inline "content"}}
    <div class="messages-container">
        <div class="message-item message-0">
            <p class="messages">
                {{{message0}}}
            </p>
        </div>

        <div class="message-item message-1">
            <textarea rows=30 id="input1" class="messages" {{inputDisabled1}}>{{message1}}</textarea>

            <div class="message-controls">
                <div id="guidance1" class="control-guidance">{{guidance1}}</div>
                <div><button id="button1" class="messages">{{buttonText1}}</button></div>
            </div>
        </div>

        <div class="message-item message-2">
            <p class="messages">
                {{{message2}}}
            </p>
        </div>

        <div class="message-item message-3">
            <textarea rows=30 id="input3" class="messages" {{inputDisabled3}}>{{message3}}</textarea>
            <div class="message-controls">
                <div id="guidance3" class="control-guidance">{{guidance3}}</div>
                <div><button id="button3" class="messages">{{buttonText3}}</button></div>
            </div>
        </div>
    </div>

    <script>
        var input1 = document.getElementById("input1");
        var input3 = document.getElementById("input3");
        var guidance1 = document.getElementById("guidance1");
        var guidance3 = document.getElementById("guidance3");
        var button1 = document.getElementById("button1");
        var button3 = document.getElementById("button3");
        var saveText = "Save";
        var savingText = "...";
        var editText = "Edit";
        var saveErrorText = "Retry";
        var savedGuidance = "Saved.";
        var editingGuidance = "";
        var errorGuidance = "Save failed. Please try again or report the problem.";

        function handleMessage(event) {
            let button;
            let input;
            let guidance;
            let messageIndex;
            let payload;
            if (event.target.id === button1.id) {
                guidance = guidance1;
                button = button1;
                input = input1;
                messageIndex = 1;
            }

            if (event.target.id === button3.id) {
                guidance = guidance3;
                button = button3;
                input = input3;
                messageIndex = 3;
            }

            if (button.innerHTML === editText) {
                input.disabled = false;
                button.innerHTML = saveText;
                guidance.innerHTML = editingGuidance;
            } else if (button.innerHTML === saveText || button.innerHTML === saveErrorText) {
                payload = { message_group: "{{messageGroup}}", author: "{{author1}}", index: messageIndex, body: input.value };
                var xhr = new XMLHttpRequest();
                xhr.open("POST", "/messages/{{messageGroup}}", true);
                xhr.setRequestHeader("Content-Type", "application/json");

                xhr.onreadystatechange = function() {
                    if (this.readyState === XMLHttpRequest.DONE) {
                        if (this.status === 201) {
                            input.disabled = true;
                            button.innerHTML = editText;
                            guidance.innerHTML = savedGuidance;
                        } else {
                            button.innerHTML = saveErrorText;
                            guidance.innerHTML = errorGuidance;
                        }
                    }
                }

                xhr.send(JSON.stringify(payload));
                button.innerHTML = savingText;
            }
        }

        button1.addEventListener("click", handleMessage);
        button3.addEventListener("click", handleMessage);
    </script>
{{/inline}}
{{~> application~}}
